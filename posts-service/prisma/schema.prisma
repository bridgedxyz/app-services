// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

model Publication{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  workspace String
  name String
  logo String?
  cover String?
  slug String @unique @default(cuid())
  createdAt DateTime @default(now())
  posts Post[]

  // publication slug must be unique per workspace
  @@unique([slug, workspace])
}

model Post {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  title  String
  summary String
  thumbnail String?
  body Json
  cover String?
  tags String[]
  isDraft Boolean
  category String?
  slug String?
  visibility Visibility @default(private)
  scheduledAt DateTime?
  createdAt DateTime @default(now())
  postedAt DateTime?
  language String?
  author String? @db.ObjectId
  publication  Publication  @relation(fields: [publicationId], references: [id])
  publicationId String @db.ObjectId

  // slugs are unique in publication
  @@unique([slug, publicationId])
}

enum Visibility{
  public
  private
  password_protected
}